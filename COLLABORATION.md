# 4方协作指南

> ChatGPT + Cursor + Replit + 人工的完整协作协议

**项目**: ProofOfInfluence  
**协作模式**: AI辅助 + 人工决策 + 自动化部署  
**最后更新**: 2025-11-02

---

## 🎭 角色与职责

### 1️⃣ ChatGPT (战略规划师)

**职责范围**:
- 📋 **需求分析**: 将模糊的想法转化为清晰的技术方案
- 🏗️ **架构设计**: 提供技术选型和系统设计建议
- 📝 **文档生成**: 生成 PRD、API 文档、README
- 🔍 **代码审查**: 分析代码质量和潜在问题
- 💡 **问题排查**: 提供调试思路和解决方案

**输入来源**:
- 用户的功能需求和业务目标
- 当前代码库的上下文
- 技术难题和报错信息

**输出目标**:
- 清晰的功能规格说明
- 代码结构和组件列表
- 文案和设计建议
- 解决方案和最佳实践

**使用时机**:
- ✅ 开始新功能前（规划阶段）
- ✅ 遇到技术难题（咨询阶段）
- ✅ 需要文档和文案（生成阶段）
- ✅ 代码出问题（排查阶段）

**典型对话模板**:
```
功能规划:
"我要为 ProofOfInfluence 添加 [功能名称]
目标用户: [用户群体]
核心价值: [1-3个要点]
请给我: 页面结构 + 组件列表 + API 设计"

代码审查:
"这段代码有性能问题吗？如何优化？
[粘贴代码]"

问题排查:
"我遇到这个错误: [错误信息]
当前环境: [技术栈]
如何解决？"
```

---

### 2️⃣ Cursor (编码执行官)

**职责范围**:
- 💻 **代码实现**: 将设计转化为可运行的代码
- 🔧 **代码重构**: 优化代码结构和性能
- 🐛 **调试修复**: 定位和修复 Bug
- 📦 **组件开发**: 创建可复用的 UI 组件
- ⚡ **快速迭代**: 本地开发和实时测试

**输入来源**:
- ChatGPT 提供的设计方案
- 用户的代码修改需求
- `.cursorrules` 中的项目规范

**输出目标**:
- 符合规范的 TypeScript/React 代码
- 通过类型检查的代码
- 本地测试通过的功能
- 可提交的 Git 变更

**使用时机**:
- ✅ 编写新功能代码
- ✅ 修改现有代码
- ✅ 重构和优化
- ✅ 本地调试测试

**核心快捷键**:
```
Ctrl/Cmd + K    行内快速编辑
Ctrl/Cmd + L    Chat（询问代码问题）
Ctrl/Cmd + I    Composer（多文件编辑）⭐ 最常用
```

**最佳实践**:
```
1. 使用 @ 引用项目文件
@design_guidelines.md  # 参考设计规范
@shared/schema.ts      # 查看数据结构
@.cursorrules          # 遵循编码规范

2. 提供详细的提示词
❌ "创建一个组件"
✅ "创建 Testimonials.tsx 组件，使用 Shadcn Card，
   支持左右滑动，显示用户头像、姓名、评价，
   参考 @design_guidelines.md 的样式规范"

3. 分步实现
- 第一步: 生成组件骨架
- 第二步: 添加样式和响应式
- 第三步: 添加交互逻辑和状态管理
```

---

### 3️⃣ Replit (部署运维官)

**职责范围**:
- 🚀 **自动部署**: 检测 main 分支更新并自动部署
- 🏃 **运行环境**: 提供生产环境运行服务
- 📊 **日志监控**: 记录运行日志和错误
- 🔐 **环境管理**: 管理生产环境的 Secrets
- 🌐 **域名访问**: 提供公开访问的 URL

**输入来源**:
- GitHub main 分支的代码推送
- `replit.yaml` 配置文件
- Replit Secrets 环境变量

**输出目标**:
- 可访问的生产环境 URL
- 部署成功/失败的日志
- 服务运行状态报告

**使用时机**:
- ✅ 代码合并到 main 分支后（自动触发）
- ✅ 需要查看生产日志（手动查看）
- ✅ 需要修改环境变量（手动配置）
- ✅ 需要手动重新部署（异常情况）

**配置要点**:
```yaml
# replit.yaml
run = "npm start"
build = "npm run build"
deploymentTarget = "autoscale"

[deployment.autoscale]
minInstances = 0  # 省钱模式，冷启动约 10-30 秒
maxInstances = 3
```

**Secrets 配置**:
```
DATABASE_URL       = <Neon 生产数据库>
SESSION_SECRET     = <生产环境密钥>
NODE_ENV          = production
```

**查看部署状态**:
1. Replit 项目 → Deployments
2. 查看最新部署日志
3. 点击 URL 访问生产环境

---

### 4️⃣ 人工 (决策指挥官)

**职责范围**:
- 🎯 **战略决策**: 确定产品方向和优先级
- ✅ **质量把关**: 审查代码和功能是否符合预期
- 🔀 **流程控制**: 决定何时合并、何时部署
- 🐛 **问题发现**: 测试功能，发现潜在问题
- 📈 **效果评估**: 评估功能上线后的效果

**工作内容**:
1. **规划阶段**: 与 ChatGPT 讨论功能需求
2. **开发阶段**: 监督 Cursor 代码实现，本地测试
3. **审查阶段**: 检查代码变更，确认符合预期
4. **部署阶段**: 推送到 GitHub，触发 Replit 部署
5. **验证阶段**: 访问生产环境，确认功能正常

**决策时机**:
- ✅ 确定新功能的具体需求
- ✅ 选择技术方案（A方案 vs B方案）
- ✅ 审查 Pull Request
- ✅ 决定是否合并到 main
- ✅ 验收部署结果

**技能要求**:
- 理解业务需求和产品逻辑
- 基本的代码阅读能力
- 使用 Git 和 GitHub
- 基本的调试和测试能力

---

## 🔄 完整协作流程

### **场景 A: 开发新功能** (标准流程, 40分钟)

```
┌─────────────────────────────────────────────────────────────┐
│ 第 1 步: 需求规划 (ChatGPT + 人工, 5分钟)                   │
├─────────────────────────────────────────────────────────────┤
│ 人工 → ChatGPT:                                              │
│   "我要添加用户评价轮播功能"                                │
│   "目标用户是 Web2 创作者和投资人"                          │
│   "需要显示头像、姓名、评价内容、职位"                      │
│                                                              │
│ ChatGPT → 人工:                                              │
│   ✅ 组件结构: Testimonials.tsx                              │
│   ✅ 使用技术: Shadcn Card + Embla Carousel                 │
│   ✅ 数据结构: { name, avatar, quote, role }                │
│   ✅ 设计建议: 3列网格，移动端单列                          │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 第 2 步: 代码实现 (Cursor + 人工, 30分钟)                   │
├─────────────────────────────────────────────────────────────┤
│ 人工操作:                                                    │
│   git checkout -b feat/testimonials                          │
│                                                              │
│ 人工 → Cursor Composer (Ctrl+I):                             │
│   "创建 Testimonials.tsx 组件，基于 ChatGPT 的设计"        │
│   "参考 @design_guidelines.md"                               │
│                                                              │
│ Cursor → 代码:                                               │
│   ✅ 生成组件骨架                                            │
│   ✅ 添加 TypeScript 类型                                    │
│   ✅ 集成 Shadcn UI 组件                                     │
│   ✅ 添加响应式样式                                          │
│                                                              │
│ 人工测试:                                                    │
│   npm run dev                                                │
│   访问 http://localhost:5173                                 │
│   ✅ 检查功能是否正常                                        │
│   ✅ 测试移动端和桌面端                                      │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 第 3 步: 代码提交 (人工 + GitHub, 2分钟)                    │
├─────────────────────────────────────────────────────────────┤
│ 人工操作:                                                    │
│   git add .                                                  │
│   git commit -m "feat: add testimonials carousel"           │
│   git push origin feat/testimonials                          │
│                                                              │
│ GitHub:                                                      │
│   ✅ 创建 Pull Request                                       │
│   ✅ 自动填充 PR 模板                                        │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 第 4 步: 代码审查 (人工 + ChatGPT可选, 3分钟)              │
├─────────────────────────────────────────────────────────────┤
│ 人工审查 PR:                                                 │
│   ✅ 检查改动文件列表                                        │
│   ✅ 查看代码 Diff                                           │
│   ✅ 确认符合预期                                            │
│                                                              │
│ 可选 - 人工 → ChatGPT:                                       │
│   "帮我审查这段代码，有没有性能问题？"                      │
│   [粘贴关键代码]                                             │
│                                                              │
│ 人工决策:                                                    │
│   ✅ 点击 "Merge pull request"                               │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ 第 5 步: 自动部署 (Replit 自动, 2分钟)                      │
├─────────────────────────────────────────────────────────────┤
│ GitHub → Replit:                                             │
│   ✅ 检测到 main 分支更新                                    │
│   ✅ 触发自动部署                                            │
│                                                              │
│ Replit 自动执行:                                             │
│   ✅ npm run build                                           │
│   ✅ npm start                                               │
│   ✅ 生成部署 URL                                            │
│                                                              │
│ 人工验证:                                                    │
│   ✅ 访问 Replit 部署 URL                                    │
│   ✅ 测试新功能                                              │
│   ✅ 确认生产环境正常                                        │
└─────────────────────────────────────────────────────────────┘

总耗时: 约 40 分钟
```

---

### **场景 B: 快速修复** (简化流程, 5分钟)

```
人工发现问题
    ↓
ChatGPT 诊断 (可选, 如果不确定原因)
    ↓
Cursor 快速修复 (直接在 main 分支)
    ↓
人工本地测试
    ↓
Git 推送 → GitHub → Replit 自动部署
    ↓
人工验证生产环境
```

---

### **场景 C: 重大重构** (谨慎流程, 2-4小时)

```
第 1 步: 详细规划 (ChatGPT + 人工, 30分钟)
  - 明确重构目标和范围
  - 讨论潜在风险和回滚方案
  - 制定分步实施计划

第 2 步: 创建长期分支 (人工)
  git checkout -b refactor/auth-system

第 3 步: 分步实现 (Cursor + 人工, 1-2小时)
  - 每次只改一小部分
  - 频繁提交到分支
  - 持续本地测试

第 4 步: 充分测试 (人工, 30分钟)
  - 测试所有关键流程
  - 测试边界情况
  - 性能测试

第 5 步: 代码审查 (ChatGPT + 人工, 30分钟)
  - ChatGPT 全面审查代码
  - 人工确认符合预期

第 6 步: 分阶段部署
  - 先合并到 dev 分支（如果有）
  - 在 Replit 测试环境验证
  - 确认无误后合并到 main
```

---

## 📊 协作矩阵

| 任务类型 | ChatGPT | Cursor | Replit | 人工 |
|---------|---------|--------|--------|------|
| **需求分析** | 🟢 主导 | - | - | 🟡 决策 |
| **架构设计** | 🟢 主导 | - | - | 🟡 决策 |
| **代码实现** | - | 🟢 主导 | - | 🟡 监督 |
| **本地测试** | - | 🟡 辅助 | - | 🟢 主导 |
| **代码审查** | 🟡 辅助 | - | - | 🟢 主导 |
| **代码提交** | - | - | - | 🟢 主导 |
| **自动部署** | - | - | 🟢 自动 | - |
| **生产验证** | - | - | - | 🟢 主导 |
| **问题排查** | 🟢 诊断 | 🟡 修复 | 🟡 日志 | 🟢 发现 |
| **性能优化** | 🟡 建议 | 🟢 实现 | 🟡 监控 | 🟡 决策 |

图例: 🟢 主导 | 🟡 辅助/监督 | - 不参与

---

## ⚡ 效率优化建议

### **提升 ChatGPT 协作效率**
1. ✅ 提供充分的上下文信息
2. ✅ 明确说明目标和约束条件
3. ✅ 分步骤询问，不要一次问太多
4. ✅ 保存常用的提示词模板

### **提升 Cursor 开发效率**
1. ✅ 熟练使用快捷键（Ctrl+I 是王道）
2. ✅ 善用 @ 引用项目文件
3. ✅ 提供详细的上下文和示例
4. ✅ 小步迭代，频繁测试

### **提升 Replit 部署效率**
1. ✅ 确保 replit.yaml 配置正确
2. ✅ 生产环境 Secrets 配置完整
3. ✅ 定期查看部署日志
4. ✅ 设置部署失败通知（如果支持）

### **提升人工工作效率**
1. ✅ 建立每日工作流习惯
2. ✅ 制定功能优先级清单
3. ✅ 使用 Git 分支管理大功能
4. ✅ 及时提交小改动
5. ✅ 定期备份和推送代码

---

## 🚨 常见问题与解决

### Q1: ChatGPT 的建议和 Cursor 生成的代码不一致？
**原因**: Cursor 可能基于本地文件生成了不同的实现  
**解决**: 
1. 将 ChatGPT 的建议详细告诉 Cursor
2. 使用 `@` 引用相关文件让 Cursor 理解上下文
3. 分步骤实现，每步都对照 ChatGPT 的方案

### Q2: Replit 自动部署失败？
**原因**: 代码构建错误或环境变量缺失  
**解决**:
1. 查看 Replit Deployments 的部署日志
2. 检查 Secrets 是否配置完整
3. 本地运行 `npm run build` 确认可以构建成功
4. 检查 `replit.yaml` 配置

### Q3: 本地测试正常，生产环境出错？
**原因**: 环境差异或环境变量问题  
**解决**:
1. 确认 Replit Secrets 与本地 .env.local 一致
2. 检查数据库连接（生产 vs 开发）
3. 查看 Replit 运行日志
4. 确认端口号使用 `process.env.PORT`

### Q4: 不知道该让 ChatGPT 做什么？
**参考场景**:
- ✅ 功能不知道怎么设计 → 问 ChatGPT 要方案
- ✅ 代码出错不知道原因 → 给 ChatGPT 看错误信息
- ✅ 需要文案或文档 → 让 ChatGPT 生成
- ✅ 技术选型不确定 → 让 ChatGPT 对比方案

### Q5: Cursor 生成的代码质量不好？
**改进方法**:
1. ✅ 提供更详细的提示词
2. ✅ 使用 `@.cursorrules` 确保遵循项目规范
3. ✅ 分步骤生成，而不是一次生成整个功能
4. ✅ 手动审查和调整 AI 生成的代码

---

## 🎯 效率指标（MVP 阶段）

| 指标 | 目标值 | 备注 |
|------|--------|------|
| 从想法到上线 | < 40 分钟 | 标准功能开发 |
| Bug 修复时间 | < 10 分钟 | 简单 Bug |
| 部署频率 | 每天 2-3 次 | 小步快跑 |
| AI 编码提效 | 3-5倍 | vs 纯手写 |
| 自动部署时间 | 1-2 分钟 | Replit 自动 |

---

## 📚 相关文档

- [WORKFLOW.md](WORKFLOW.md) - 详细的工作流程
- [CHECKLIST.md](CHECKLIST.md) - 每日工作检查清单
- [README.md](README.md) - 项目概览
- [.cursorrules](.cursorrules) - Cursor AI 规范
- [docs/QUICK_START.md](docs/QUICK_START.md) - 快速开始
- [docs/ENV_SETUP.md](docs/ENV_SETUP.md) - 环境配置

---

**最后更新**: 2025-11-02  
**维护者**: ProofOfInfluence 团队  
**适用版本**: MVP v1.0+

