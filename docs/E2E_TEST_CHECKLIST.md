# 端到端测试清单

**最后更新**: 2025-11-17  
**测试网络**: Base Sepolia (Chain ID: 84532)  
**测试环境**: 前端 + 后端 + 智能合约

---

## 测试前准备

1. ✅ 确保所有合约已部署到 Base Sepolia
2. ✅ 确保环境变量已正确配置（`.env` 和 `client/.env.local`）
3. ✅ 确保钱包已连接到 Base Sepolia 测试网
4. ✅ 确保钱包有足够的 ETH 用于 Gas 费用
5. ✅ 确保钱包有测试 USDC（如需要）

---

## 流程 1：TGE 认购

### 测试步骤

1. **连接钱包**
   - 打开 `/tge` 页面
   - 点击"连接钱包"按钮
   - 选择 MetaMask 或其他支持的钱包
   - 确认连接到 Base Sepolia (Chain ID: 84532)

2. **查看 TGE 信息**
   - 确认当前 tier、价格、剩余代币数量显示正确
   - 确认最小/最大贡献额度显示正确
   - 确认销售窗口时间显示正确

3. **购买 POI**
   - 输入 USDC 金额（在最小/最大范围内）
   - 点击"购买"按钮
   - 在钱包中确认交易
   - 等待交易确认

4. **验证交易**
   - 在钱包中查看交易状态
   - 在 Base Sepolia 区块浏览器（https://sepolia.basescan.org）查看交易详情
   - 确认 POI 代币已发送到钱包
   - 确认已购数量已更新

### 预期结果

- ✅ 钱包成功连接到 Base Sepolia
- ✅ TGE 信息正确显示
- ✅ 交易成功执行
- ✅ POI 代币正确发送
- ✅ 前端状态正确更新

---

## 流程 2：Staking（质押）

### 测试步骤

1. **查看质押状态**
   - 打开 Dashboard 页面
   - 找到 StakingCard
   - 确认当前质押余额、奖励、APR 等信息显示

2. **授权 POI 代币**
   - 如果首次质押，需要先授权 StakingRewards 合约
   - 点击"授权"按钮
   - 在钱包中确认授权交易

3. **质押 POI**
   - 输入质押数量
   - 点击"质押"按钮
   - 在钱包中确认交易
   - 等待交易确认

4. **查看奖励**
   - 等待若干区块（至少 1-2 分钟）
   - 确认"可领取奖励"数量已更新
   - 点击"领取奖励"按钮
   - 在钱包中确认交易

5. **解除质押**
   - 点击"提取"按钮
   - 输入提取数量
   - 在钱包中确认交易
   - 确认 POI 代币已返回钱包

### 预期结果

- ✅ 质押状态正确显示
- ✅ 授权交易成功
- ✅ 质押交易成功
- ✅ 奖励正确计算和显示
- ✅ 领取奖励成功
- ✅ 解除质押成功

---

## 流程 3：Vesting（锁仓释放）

### 测试步骤

1. **查看锁仓计划**
   - 打开 Dashboard 页面
   - 找到 VestingCard
   - 确认锁仓计划列表显示（如果有）

2. **查看释放信息**
   - 确认每个计划的：
     - 总金额
     - 已释放金额
     - 可释放金额
     - 释放时间表

3. **执行释放**
   - 如果有可释放金额，点击"释放"按钮
   - 在钱包中确认交易
   - 等待交易确认

4. **验证余额变化**
   - 在钱包中查看 POI 余额
   - 确认余额已增加
   - 确认已释放金额已更新

### 预期结果

- ✅ 锁仓计划正确显示
- ✅ 释放信息准确
- ✅ 释放交易成功
- ✅ 余额正确更新

---

## 流程 4：Airdrop（空投领取）

### 测试步骤

1. **检查空投资格**
   - 打开 `/airdrop` 页面或 Dashboard 中的 AirdropCard
   - 确认页面加载时自动检查空投资格
   - 如果有资格，确认空投金额和索引显示

2. **验证链上状态**
   - 确认 `isClaimed` 状态正确显示（未领取应显示 false）
   - 如果已领取，确认显示"已领取"状态

3. **领取空投**
   - 点击"领取空投"按钮
   - 在钱包中确认交易
   - 等待交易确认

4. **验证领取结果**
   - 确认交易成功
   - 在区块浏览器查看交易详情
   - 确认 POI 代币已发送到钱包
   - 确认页面状态更新为"已领取"
   - 确认按钮已禁用

5. **再次检查**
   - 刷新页面
   - 确认 `isClaimed` 状态为 true
   - 确认 UI 正确显示"已领取"状态

### 预期结果

- ✅ 空投资格检查正确
- ✅ 链上 `isClaimed` 状态正确
- ✅ 领取交易成功
- ✅ 代币正确发送
- ✅ 状态正确更新
- ✅ 已领取状态正确显示

---

## 流程 5：Allowlist（白名单验证）

### 测试步骤

1. **检查白名单状态**
   - 打开 Dashboard 中的 AllowlistCard
   - 确认 Merkle root 和版本显示
   - 确认剩余分配额度显示

2. **验证白名单资格**
   - 如果地址在白名单中：
     - 确认显示"您在白名单中"
     - 确认剩余分配额度 > 0
   - 如果地址不在白名单中：
     - 确认显示"未在白名单中"

3. **验证链上状态**
   - 确认 `remaining` 函数返回正确值
   - 确认 `verify` 函数（如果调用）返回正确结果

### 预期结果

- ✅ 白名单状态正确显示
- ✅ 链上验证结果正确
- ✅ 剩余额度正确显示
- ✅ UI 提示准确

---

## 流程 6：Referral（推荐系统）

### 测试步骤

1. **查看推荐状态**
   - 打开 Dashboard 中的 ReferralCard
   - 确认推荐关系显示（如果有）

2. **注册推荐关系**
   - 如果有推荐码，输入推荐码
   - 点击"注册"按钮
   - 在钱包中确认交易
   - 等待交易确认

3. **验证链上记录**
   - 在区块浏览器查看交易
   - 确认推荐关系已记录在链上
   - 确认推荐码正确关联

4. **查看推荐统计**
   - 确认推荐人数显示
   - 确认推荐奖励显示（如果有）

### 预期结果

- ✅ 推荐状态正确显示
- ✅ 注册交易成功
- ✅ 链上记录正确
- ✅ 统计信息准确

---

## 流程 7：Badges（徽章系统）

### 测试步骤

1. **查看徽章**
   - 打开 Dashboard 中的 BadgeCard
   - 确认已获得的徽章显示

2. **触发获取徽章**
   - 完成相应任务（如质押、推荐等）
   - 等待后端处理徽章授予

3. **验证徽章更新**
   - 刷新页面
   - 确认新徽章已显示
   - 确认徽章元数据正确（名称、图片等）

4. **验证链上状态**
   - 在区块浏览器查看 AchievementBadges 合约
   - 确认徽章已铸造到地址
   - 确认徽章类型和 tokenId 正确

### 预期结果

- ✅ 徽章正确显示
- ✅ 徽章授予成功
- ✅ 链上记录正确
- ✅ 元数据准确

---

## 流程 8：完整用户旅程

### 测试步骤

1. **新用户注册**
   - 连接钱包
   - 完成认证

2. **参与 TGE**
   - 购买 POI 代币

3. **质押代币**
   - 质押部分 POI
   - 领取奖励

4. **领取空投**
   - 如果有资格，领取空投

5. **使用推荐**
   - 注册推荐关系
   - 邀请好友

6. **收集徽章**
   - 完成各种任务
   - 收集徽章

### 预期结果

- ✅ 所有流程顺畅
- ✅ 无错误或异常
- ✅ 状态正确同步
- ✅ 用户体验良好

---

## 常见问题排查

### 问题 1：钱包连接失败

**可能原因**：
- 网络未切换到 Base Sepolia
- RPC URL 配置错误

**解决方法**：
- 确认钱包网络为 Base Sepolia (Chain ID: 84532)
- 检查 `VITE_BASE_RPC_URL` 配置

### 问题 2：交易失败

**可能原因**：
- Gas 费用不足
- 合约地址错误
- 参数错误

**解决方法**：
- 确保钱包有足够 ETH
- 检查合约地址配置
- 查看交易错误信息

### 问题 3：状态未更新

**可能原因**：
- 前端缓存
- 后端未同步
- 合约事件未索引

**解决方法**：
- 刷新页面
- 检查后端日志
- 确认事件索引器运行

---

## 测试记录模板

```
测试日期: YYYY-MM-DD
测试人员: [姓名]
测试环境: Base Sepolia

流程 1 - TGE 认购: ✅ / ❌
  备注: [任何问题或观察]

流程 2 - Staking: ✅ / ❌
  备注: [任何问题或观察]

流程 3 - Vesting: ✅ / ❌
  备注: [任何问题或观察]

流程 4 - Airdrop: ✅ / ❌
  备注: [任何问题或观察]

流程 5 - Allowlist: ✅ / ❌
  备注: [任何问题或观察]

流程 6 - Referral: ✅ / ❌
  备注: [任何问题或观察]

流程 7 - Badges: ✅ / ❌
  备注: [任何问题或观察]

流程 8 - 完整旅程: ✅ / ❌
  备注: [任何问题或观察]

总体评价: [整体测试结果和反馈]
```

---

## 自动化测试（可选）

如果项目已配置 Cypress 或 Playwright，可以创建自动化测试覆盖：

1. **基础连接测试**
   - 连接钱包
   - 切换到正确网络
   - 读取合约状态

2. **合约交互测试**
   - 读取 POI 余额
   - 读取 Staking 状态
   - 读取 Vesting 计划

3. **UI 测试**
   - 页面加载
   - 组件渲染
   - 交互响应

---

**注意**: 此清单应在每次重大更新后重新执行，确保所有功能正常工作。

